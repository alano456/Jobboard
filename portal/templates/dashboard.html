{% extends 'base.html' %}
{% block title %}Panel uÅ¼ytkownika{% endblock %}
{% block content %}
<h2 class="mb-4">ğŸ“Š Panel uÅ¼ytkownika</h2>
<!-- Statystyki -->
<div class="row mb-5">
  {% if is_employer %}
    <div class="col-md-6">
      <div class="card text-bg-light shadow-sm border-0">
        <div class="card-body d-flex align-items-center">
          <div class="me-3 display-5">ğŸ’¼</div>
          <div>
            <h5 class="card-title mb-1">Twoje oferty pracy</h5>
            <p class="card-text">{{ user_jobs|length }} ofert</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card text-bg-light shadow-sm border-0">
        <div class="card-body d-flex align-items-center">
          <div class="me-3 display-5">ğŸ“„</div>
          <div>
            <h5 class="card-title mb-1">Aplikacje</h5>
            <p class="card-text">{{ applications|length }} aplikacji</p>
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="col-md-6">
      <div class="card text-bg-light shadow-sm border-0">
        <div class="card-body d-flex align-items-center">
          <div class="me-3 display-5">â­</div>
          <div>
            <h5 class="card-title mb-1">Zapisane oferty</h5>
            <p class="card-text">{{ saved|length }} ofert</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card text-bg-light shadow-sm border-0">
        <div class="card-body d-flex align-items-center">
          <div class="me-3 display-5">ğŸ“„</div>
          <div>
            <h5 class="card-title mb-1">Twoje aplikacje</h5>
            <p class="card-text">{{ applications|length }} aplikacji</p>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div>
<!-- Sekcja dla pracodawcy -->
{% if is_employer %}
<section class="mb-5">
  <h4 class="mb-3">ğŸ’¼ Twoje oferty pracy</h4>
  {% if user_jobs %}
  <div class="row row-cols-1 row-cols-md-2 g-4">
    {% for job in user_jobs %}
    <div class="col">
      <div class="card h-100 shadow-sm border-0">
        <div class="row g-0 h-100">
          {% if job.image %}
          <div class="col-4">
            <img src="{{ job.image.url }}" alt="{{ job.title }}" class="img-fluid rounded-start h-100 object-fit-cover">
          </div>
          {% endif %}
          <div class="col">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ job.title }}</h5>
              <p class="card-text text-muted">{{ job.description|truncatewords:20 }}</p>
              <p class="text-success">{{ job.get_salary_range }}</p>
              <div class="mt-auto">
                <a href="{% url 'job_detail' job.id %}" class="btn btn-sm btn-outline-primary me-2">ğŸ” Zobacz</a>
                <a href="{% url 'job_edit' job.id %}" class="btn btn-sm btn-outline-warning me-2">âœï¸ Edytuj</a>
                <a href="{% url 'job_delete' job.id %}" class="btn btn-sm btn-outline-danger">ğŸ—‘ï¸ UsuÅ„</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="alert alert-info mt-3">Nie masz jeszcze Å¼adnych ofert pracy.</div>
  {% endif %}
</section>
<section class="mb-5">
  <h4 class="mb-3">ğŸ“„ Aplikacje do Twoich ofert</h4>
  {% if applications %}
  <div class="row row-cols-1 row-cols-md-2 g-4">
    {% for app in applications %}
    <div class="col">
      <div class="card h-100 shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title">Aplikacja na: {{ app.job.title }}</h5>
          <p class="card-text">{{ app.candidate.username }} - Status: {{ app.get_status_display }}</p>
          {% if app.cover_letter %}
            <p class="card-text small">{{ app.cover_letter|truncatewords:15 }}</p>
          {% endif %}
          <a href="{% url 'job_detail' app.job.id %}" class="btn btn-sm btn-outline-primary">Zobacz ofertÄ™</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="alert alert-secondary mt-3">Brak aplikacji.</div>
  {% endif %}
</section>
{% else %}
<!-- Sekcja dla kandydata -->
<section class="mb-5">
  <h4 class="mb-3">â­ Zapisane oferty pracy</h4>
  {% if saved %}
  <div class="row row-cols-1 row-cols-md-2 g-4">
    {% for job in saved %}
    <div class="col">
      <div class="card h-100 shadow-sm border-0">
        <div class="row g-0 h-100">
          {% if job.image %}
          <div class="col-4">
            <img src="{{ job.image.url }}" alt="{{ job.title }}" class="img-fluid rounded-start h-100 object-fit-cover">
          </div>
          {% endif %}
          <div class="col">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ job.title }}</h5>
              <p class="card-text text-muted">{{ job.description|truncatewords:20 }}</p>
              <p class="text-success">{{ job.get_salary_range }}</p>
              <div class="mt-auto">
                <a href="{% url 'job_detail' job.id %}" class="btn btn-sm btn-outline-primary">ğŸ” Zobacz</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="alert alert-secondary mt-3">Brak zapisanych ofert pracy.</div>
  {% endif %}
</section>
<section class="mb-5">
  <h4 class="mb-3">ğŸ“„ Twoje aplikacje</h4>
  {% if applications %}
  <div class="row row-cols-1 row-cols-md-2 g-4">
    {% for app in applications %}
    <div class="col">
      <div class="card h-100 shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title">Aplikacja na: {{ app.job.title }}</h5>
          <p class="card-text">Status: {{ app.get_status_display }} | {{ app.created_at|date:"d.m.Y" }}</p>
          {% if app.cover_letter %}
            <p class="card-text small">{{ app.cover_letter|truncatewords:15 }}</p>
          {% endif %}
          <a href="{% url 'job_detail' app.job.id %}" class="btn btn-sm btn-outline-primary">Zobacz ofertÄ™</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="alert alert-info mt-3">Nie zÅ‚oÅ¼yÅ‚eÅ› jeszcze Å¼adnych aplikacji.</div>
  {% endif %}
</section>
{% endif %}
<!-- Ostatnia aktywnoÅ›Ä‡ -->
<section class="mt-5">
  <h4 class="mb-3">ğŸ“Œ Ostatnia aktywnoÅ›Ä‡</h4>
  <div class="row row-cols-1 row-cols-md-2 g-4">
    <!-- WiadomoÅ›ci -->
    <div class="col">
      <div class="card h-100 border-0 shadow-sm">
        <div class="card-header bg-primary text-white">ğŸ“¬ Ostatnie wiadomoÅ›ci</div>
        <div class="card-body">
          {% if recent_messages %}
            <ul class="list-group list-group-flush">
              {% for msg in recent_messages %}
              <li class="list-group-item">
                <strong>Od:</strong> {{ msg.sender.username }}<br>
                <small class="text-muted">{{ msg.created_at|date:"d.m.Y H:i" }}</small><br>
                <span>{{ msg.text|truncatewords:12 }}</span>
              </li>
              {% endfor %}
            </ul>
            <a href="{% url 'inbox' %}" class="btn btn-sm btn-outline-primary mt-3">ğŸ“¥ Zobacz wszystkie</a>
          {% else %}
            <p class="text-muted">Brak nowych wiadomoÅ›ci.</p>
          {% endif %}
        </div>
      </div>
    </div>
    <!-- Rekomendacje -->
    <div class="col">
      <div class="card h-100 border-0 shadow-sm">
        <div class="card-header bg-success text-white">
          {% if is_employer %}ğŸ’¬ Opinie o Tobie{% else %}ğŸ’¬ Twoje opinie{% endif %}
        </div>
        <div class="card-body">
          {% if recent_recommendations %}
            <ul class="list-group list-group-flush">
              {% for rec in recent_recommendations %}
              <li class="list-group-item">
                <strong>Od:</strong> {{ rec.from_user.username }}
                {% if rec.is_positive %}
                  <span class="text-success">Poleca</span>
                {% else %}
                  <span class="text-danger">Nie poleca</span>
                {% endif %}<br>
                <span>{{ rec.comment|truncatewords:15 }}</span>
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">Brak opinii jeszcze.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}